<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">

    <changeSet id="fdbd9b7c-72bf-4326-89c1-cf660b19c0a7" author="patrick@patrick-gotthard.de">
        <comment>Create table "users"</comment>
        <createTable tableName="users">
            <column name="id" type="INTEGER" autoIncrement="true">
                <constraints primaryKey="true" />
            </column>
            <column name="username" type="VARCHAR(32)">
                <constraints nullable="false" />
            </column>
            <column name="password" type="CHAR(60)">
                <constraints nullable="false" />
            </column>
            <column name="role" type="VARCHAR(32)">
                <constraints nullable="false" />
            </column>
        </createTable>
    </changeSet>

    <changeSet id="1f0136ee-fc25-48c1-9632-27709ee17681" author="patrick@patrick-gotthard.de">
        <comment>Add unique constraint users[username]</comment>
        <addUniqueConstraint constraintName="unique_user" tableName="users" columnNames="username" />
    </changeSet>
    
    <changeSet id="bf244d6c-5b11-4e2f-bf7c-05c0c9554a33" author="patrick@patrick-gotthard.de">
        <comment>Create table "feeds"</comment>
        <createTable tableName="feeds">
            <column name="id" type="INTEGER" autoIncrement="true">
                <constraints primaryKey="true" />
            </column>
            <column name="url" type="VARCHAR(1024)">
                <constraints nullable="false" />
            </column>
            <column name="title" type="VARCHAR(512)">
                <constraints nullable="false" />
            </column>
        </createTable>
    </changeSet>

    <changeSet id="afe0639e-3fa3-41cc-bafd-0986c672a999" author="patrick@patrick-gotthard.de">
        <comment>Create table "entries"</comment>
        <createTable tableName="entries">
            <column name="id" type="INTEGER" autoIncrement="true">
                <constraints primaryKey="true" />
            </column>
            <column name="feed_id" type="INTEGER">
                <constraints nullable="false" />
            </column>
            <column name="uri" type="VARCHAR(1024)">
                <constraints nullable="false" />
            </column>
            <column name="url" type="VARCHAR(1024)">
                <constraints nullable="false" />
            </column>
            <column name="title" type="VARCHAR(512)">
                <constraints nullable="false" />
            </column>
            <column name="content" type="CLOB">
                <constraints nullable="false" />
            </column>
            <column name="publish_date" type="DATETIME">
                <constraints nullable="false" />
            </column>
        </createTable>
    </changeSet>

    <changeSet id="88713246-4d5b-49fa-adb8-c339465a4bf0" author="patrick@patrick-gotthard.de">
        <comment>Add foreign key constraint entries->feeds</comment>
        <addForeignKeyConstraint constraintName="fk_entries_feed_id" baseTableName="entries"
            baseColumnNames="feed_id" referencedTableName="feeds" referencedColumnNames="id" />
    </changeSet>

    <changeSet id="7ed4757b-a464-4c0a-be77-8cbcca9ef028" author="patrick@patrick-gotthard.de">
        <comment>Create table "folders"</comment>
        <createTable tableName="folders">
            <column name="id" type="INTEGER" autoIncrement="true">
                <constraints primaryKey="true" />
            </column>
            <column name="user_id" type="INTEGER">
                <constraints nullable="false" />
            </column>
            <column name="title" type="VARCHAR(512)">
                <constraints nullable="false" />
            </column>
        </createTable>
    </changeSet>

    <changeSet id="b02c50c0-91f7-4308-9277-846af644dad3" author="patrick@patrick-gotthard.de">
        <comment>Add foreign key constraint folders->users</comment>
        <addForeignKeyConstraint constraintName="fk_folders_user_id" baseTableName="folders"
            baseColumnNames="user_id" referencedTableName="users" referencedColumnNames="id" />
    </changeSet>

    <changeSet id="8070a4a8-412b-474a-a8ec-9dfd88dcb0ca" author="patrick@patrick-gotthard.de">
        <comment>Create table "subscriptions"</comment>
        <createTable tableName="subscriptions">
            <column name="id" type="INTEGER" autoIncrement="true">
                <constraints primaryKey="true" />
            </column>
            <column name="user_id" type="INTEGER">
                <constraints nullable="false" />
            </column>
            <column name="folder_id" type="INTEGER" />
            <column name="feed_id" type="INTEGER">
                <constraints nullable="false" />
            </column>
            <column name="title" type="VARCHAR(512)">
                <constraints nullable="false" />
            </column>
        </createTable>
    </changeSet>

    <changeSet id="e5b4587f-3222-44c8-b5a3-f9c2ecad67a3" author="patrick@patrick-gotthard.de">
        <comment>Add foreign key constraint subscriptions->users</comment>
        <addForeignKeyConstraint constraintName="fk_subscriptions_user_id" baseTableName="subscriptions"
            baseColumnNames="user_id" referencedTableName="users" referencedColumnNames="id" />
    </changeSet>

    <changeSet id="0653bd35-be3b-41a7-8d97-9a8e56254221" author="patrick@patrick-gotthard.de">
        <comment>Add foreign key constraint subscriptions->folders</comment>
        <addForeignKeyConstraint constraintName="fk_subscriptions_folder_id" baseTableName="subscriptions"
            baseColumnNames="folder_id" referencedTableName="folders" referencedColumnNames="id" />
    </changeSet>

    <changeSet id="5e73356e-4f38-4ada-bab8-298574a9d2d7" author="patrick@patrick-gotthard.de">
        <comment>Add foreign key constraint subscriptions->feeds</comment>
        <addForeignKeyConstraint constraintName="fk_subscriptions_feed_id" baseTableName="subscriptions"
            baseColumnNames="feed_id" referencedTableName="feeds" referencedColumnNames="id" />
    </changeSet>

    <changeSet id="3d35b120-9daa-45d8-9ae5-bc319eb25f8f" author="patrick@patrick-gotthard.de">
        <comment>Add unique constraint subscriptions[user_id, feed_id]</comment>
        <addUniqueConstraint constraintName="unique_subscription" tableName="subscriptions"
            columnNames="user_id, feed_id" />
    </changeSet>

    <changeSet id="07f4a37f-4836-4be8-a92e-c76dbc233642" author="patrick@patrick-gotthard.de">
        <comment>Create table "user_entries"</comment>
        <createTable tableName="user_entries">
            <column name="id" type="INTEGER" autoIncrement="true">
                <constraints primaryKey="true" />
            </column>
            <column name="subscription_id" type="INTEGER">
                <constraints nullable="false" />
            </column>
            <column name="entry_id" type="INTEGER">
                <constraints nullable="false" />
            </column>
            <column name="marked_read" type="BOOLEAN">
                <constraints nullable="false" />
            </column>
            <column name="bookmarked" type="BOOLEAN">
                <constraints nullable="false" />
            </column>
        </createTable>
    </changeSet>

    <changeSet id="bb3fe292-5fcd-4ea7-af42-e3522d24bd64" author="patrick@patrick-gotthard.de">
        <comment>Add foreign key constraint user_entries->subscriptions</comment>
        <addForeignKeyConstraint constraintName="fk_user_entries_subscription_id" baseTableName="user_entries"
            baseColumnNames="subscription_id" referencedTableName="subscriptions" referencedColumnNames="id" />
    </changeSet>

    <changeSet id="bf7afdf5-5393-4230-a565-28b28faba2aa" author="patrick@patrick-gotthard.de">
        <comment>Add foreign key constraint user_entries->entries</comment>
        <addForeignKeyConstraint constraintName="fk_user_entries_entry_id" baseTableName="user_entries"
            baseColumnNames="entry_id" referencedTableName="entries" referencedColumnNames="id" />
    </changeSet>

    <changeSet id="7b26bb96-76bd-48ad-b534-406c7c52a3d7" author="patrick@patrick-gotthard.de">
        <comment>Add unique constraint user_entries[subscription_id, entry_id]</comment>
        <addUniqueConstraint constraintName="unique_user_entry" tableName="user_entries"
            columnNames="subscription_id, entry_id" />
    </changeSet>

</databaseChangeLog>
